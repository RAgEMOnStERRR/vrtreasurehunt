<!DOCTYPE html>
<html>
<head>
    <title>EEE Treasure Hunt</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
        }
        .popup-content {
            background: linear-gradient(135deg, #f5d76e, #d4ac0d);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border: 5px solid #b7950b;
            animation: popIn 0.5s ease-out;
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .popup-content h2 {
            color: #8b6914;
            margin-top: 0;
            font-size: 28px;
        }
        .popup-content p {
            color: #5e4a0e;
            font-size: 18px;
            line-height: 1.5;
        }
        .close-btn {
            background: #8b6914;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: background 0.3s;
        }
        .close-btn:hover {
            background: #6b4f0a;
        }
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 10;
            max-width: 300px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
      
        .click-indicator {
            position: absolute;
            bottom: 60px;
            right: 20px;
            background: rgba(255, 215, 0, 0.9);
            color: black;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 10;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <a-scene>
        <!-- Sky background -->
        <a-sky src="eeeentrance.jpeg" color="#87CEEB"></a-sky>
        
        <!-- Next location marker - Enhanced Compass icon in top right corner -->
        <a-entity id="compass" class="clickable" position="4.5 3.5 -5" scale="1.5 1.5 1.5">
            <!-- Compass base -->
            <a-cylinder 
                position="0 0 0" 
                radius="0.3" 
                height="0.05" 
                color="#FFD700"
                rotation="0 0 0">
            </a-cylinder>
            <!-- Compass rose -->
            <a-ring 
                position="0 0.03 0" 
                radius-inner="0.2" 
                radius-outer="0.3" 
                color="#8B4513"
                rotation="-90 0 0">
            </a-ring>
            <!-- Compass needle base -->
            <a-cylinder 
                position="0 0.05 0" 
                radius="0.05" 
                height="0.02" 
                color="#C0C0C0">
            </a-cylinder>
            <!-- North needle -->
            <a-box 
                position="0 0.1 0.2" 
                width="0.05" 
                height="0.01" 
                depth="0.4" 
                color="#FF0000">
            </a-box>
            <!-- South needle -->
            <a-box 
                position="0 0.1 -0.2" 
                width="0.05" 
                height="0.01" 
                depth="0.4" 
                color="#0000FF">
            </a-box>
            <!-- Direction markers -->
            <a-text 
                value="NEXT" 
                position="0 0.4 0" 
                align="center" 
                color="#FF0000" 
                scale="0.8 0.8 0.8">
            </a-text>
            <!-- Glowing effect -->
            <a-light type="point" intensity="0.5" color="#FFD700" position="0 0.2 0"></a-light>
            <!-- Rotation animation -->
            <a-animation 
                attribute="rotation" 
                to="0 360 0" 
                dur="8000" 
                repeat="indefinite">
            </a-animation>
            <!-- Floating animation -->
            <a-animation 
                attribute="position" 
                to="4.5 3.7 -5" 
                dur="2000" 
                direction="alternate" 
                repeat="indefinite">
            </a-animation>
        </a-entity>
        
        <!-- Map marker - Enhanced Map icon in top left corner -->
        <a-entity id="mapIcon" class="clickable" position="-4.5 3.5 -5" scale="1.5 1.5 1.5">
            <!-- Map scroll base -->
            <a-cylinder 
                position="0 0 0" 
                radius="0.3" 
                height="0.05" 
                color="#8B4513"
                rotation="0 0 0">
            </a-cylinder>
            <!-- Map paper -->
            <a-circle 
                position="0 0.03 0" 
                radius="0.25" 
                color="#F5F5DC"
                rotation="-90 0 0">
            </a-circle>
            <!-- Map details -->
            <a-plane 
                position="-0.1 0.035 0.1" 
                width="0.15" 
                height="0.1" 
                color="#FF6347"
                rotation="-90 0 0">
            </a-plane>
            <a-plane 
                position="0.1 0.035 -0.1" 
                width="0.1" 
                height="0.15" 
                color="#4682B4"
                rotation="-90 0 0">
            </a-plane>
            <a-circle 
                position="0.05 0.035 0.08" 
                radius="0.03" 
                color="#32CD32"
                rotation="-90 0 0">
            </a-circle>
            <!-- "X" marks the spot -->
            <a-entity position="0 0.035 0" rotation="-90 0 0">
                <a-plane position="-0.05 0 0.05" width="0.02" height="0.1" color="#FF0000" rotation="0 0 45"></a-plane>
                <a-plane position="0.05 0 -0.05" width="0.02" height="0.1" color="#FF0000" rotation="0 0 45"></a-plane>
            </a-entity>
            <!-- Map label -->
            <a-text 
                value="MAP" 
                position="0 0.4 0" 
                align="center" 
                color="#8B4513" 
                scale="0.8 0.8 0.8">
            </a-text>
            <!-- Glowing effect -->
            <a-light type="point" intensity="0.5" color="#8B4513" position="0 0.2 0"></a-light>
            <!-- Floating animation -->
            <a-animation 
                attribute="position" 
                to="-4.5 3.7 -5" 
                dur="2000" 
                direction="alternate" 
                repeat="indefinite">
            </a-animation>
            <!-- Slight rotation animation -->
            <a-animation 
                attribute="rotation" 
                to="0 0 5" 
                dur="3000" 
                direction="alternate" 
                repeat="indefinite">
            </a-animation>
        </a-entity>
        
        <!-- Hidden treasure - Enhanced Chest icon -->
        <a-entity id="treasure" class="clickable treasure" position="0 0.5 -4" scale="1 1 1">
            <!-- Treasure chest base -->
            <a-box 
                position="0 -0.15 0" 
                width="0.8" 
                height="0.3" 
                depth="0.5" 
                color="#8B4513">
            </a-box>
            <!-- Treasure chest lid -->
            <a-box 
                position="0 0.1 0" 
                width="0.8" 
                height="0.05" 
                depth="0.5" 
                color="#A0522D" 
                rotation="-15 0 0">
            </a-box>
            <!-- Treasure chest lock -->
            <a-cylinder 
                position="0 0.05 0.25" 
                radius="0.04" 
                height="0.05" 
                color="#FFD700">
            </a-cylinder>
            <!-- Treasure inside (slightly visible) -->
            <a-box 
                position="0 -0.05 0" 
                width="0.6" 
                height="0.1" 
                depth="0.3" 
                color="#FFD700">
            </a-box>
            <!-- Glowing particles around treasure -->
            <a-entity particle-system="preset: star; color: #FFD700, #FFA500; particleCount: 30"></a-entity>
            <!-- Treasure label -->
            <a-text 
                value="TREASURE!" 
                position="0 0.8 0" 
                align="center" 
                color="#FFD700" 
                scale="1 1 1">
            </a-text>
            <!-- Subtle rotation animation -->
            <a-animation 
                attribute="rotation" 
                to="0 360 0" 
                dur="20000" 
                repeat="indefinite">
            </a-animation>
            <!-- Floating animation -->
            <a-animation 
                attribute="position" 
                to="0 0.7 -4" 
                dur="3000" 
                direction="alternate" 
                repeat="indefinite">
            </a-animation>
            <!-- Glowing light -->
            <a-light type="point" intensity="1.0" color="#FFD700" position="0 0.3 0" distance="5"></a-light>
        </a-entity>
        
        <!-- Player camera with cursor for both desktop and VR -->
        <a-camera position="0 1.6 0" wasd-controls look-controls>
            <!-- Cursor that works in both desktop and VR mode -->
            <a-cursor 
                id="cursor"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat; opacity: 0.9"
                raycaster="objects: .clickable; far: 20"
                fuse="true"
                fuse-timeout="1500"
                animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
                animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1">
            </a-cursor>
        </a-camera>
        
        <!-- Ambient lighting -->
        <a-light type="ambient" color="#4455AA" intensity="0.3"></a-light>
        <a-light type="directional" color="#FFFFFF" intensity="0.7" position="-1 1 1"></a-light>
    </a-scene>
    
    <!-- Merged treasure found and next location popup -->
    <div id="treasurePopup" class="popup-overlay">
        <div class="popup-content">
            <h2>🎉 Treasure Found! 🎉</h2>
            <p>Congratulations! You've discovered the hidden treasure near the EEE building!</p>
            <p>You've earned 50 treasure points!</p>
            <br>
            <h2>🧭 Next Adventure</h2>
            <p>Your next clue is: <strong>"Look for the tallest structure on campus"</strong></p>
            <p><strong>Destination: Campus Tower</strong></p>
            <p>Look for the tallest building on campus!</p>
            <button class="close-btn" onclick="closePopup()">Continue Adventure</button>
        </div>
    </div>
    
    <!-- Instructions -->
    <div class="instructions">
        <h3>Treasure Hunt Instructions</h3>
        <p>Look at objects for 1.5 seconds or click to interact:</p>
        <p>• Compass icon - Go to next location</p>
        <p>• Map icon - View the treasure map</p>
        <p>• Find the hidden treasure chest!</p>
        <p><strong>In VR:</strong> Gaze at objects to select them</p>
    </div>

    <!-- Click indicator -->
    <div class="click-indicator">
        Look at objects to interact!
    </div>

    <script>
        // Wait for A-Frame to load
        document.querySelector('a-scene').addEventListener('loaded', function() {
            console.log('A-Frame scene loaded');
            
            const cursor = document.getElementById('cursor');
            
            // Add click event to treasure (works with both click and fuse)
            const treasure = document.getElementById('treasure');
            treasure.addEventListener('click', handleTreasureClick);
            cursor.addEventListener('fusing', function(evt) {
                if (evt.detail.intersectedEl === treasure) {
                    console.log('Fusing on treasure');
                }
            });
            
            function handleTreasureClick(evt) {
                console.log('Treasure clicked!');
                evt.stopPropagation();
                
                // Show popup
                document.getElementById('treasurePopup').style.visibility = 'visible';
                
                // Add explosion effect
                const explosion = document.createElement('a-entity');
                explosion.setAttribute('position', treasure.getAttribute('position'));
                explosion.setAttribute('particle-system', 'preset: explosion; color: #FFD700, #FFA500, #FF4500; particleCount: 150');
                document.querySelector('a-scene').appendChild(explosion);
                
                // Add sound effect (simple beep)
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkeFGGT4uTRoGMdBjmL1vLAchz0lEH');
                    audio.play();
                } catch(e) {
                    console.log('Sound not available');
                }
                
                // Remove explosion after 3 seconds
                setTimeout(function() {
                    if (explosion.parentNode) {
                        explosion.parentNode.removeChild(explosion);
                    }
                }, 3000);
            }

            // Add click event to compass (redirect to annexure.html)
            const compass = document.getElementById('compass');
            compass.addEventListener('click', function(evt) {
                console.log('Compass clicked!');
                evt.stopPropagation();
                window.location.href = 'annexure.html';
            });

            // Add click event to map (redirect to map.html)
            const mapIcon = document.getElementById('mapIcon');
            mapIcon.addEventListener('click', function(evt) {
                console.log('Map clicked! Redirecting to map.html');
                evt.stopPropagation();
                // Redirect to map.html
                window.location.href = 'map.html';
            });
            
            // Also handle fuse event for VR mode
            mapIcon.addEventListener('fusing', function(evt) {
                console.log('Map icon fusing in VR mode');
            });

            // Add hover effects
            const clickables = document.querySelectorAll('.clickable');
            clickables.forEach(function(element) {
                element.addEventListener('mouseenter', function() {
                    const currentScale = this.getAttribute('scale');
                    const baseScale = 1.5;
                    this.setAttribute('scale', '1.8 1.8 1.8');
                });
                
                element.addEventListener('mouseleave', function() {
                    this.setAttribute('scale', '1.5 1.5 1.5');
                });
            });
        });
        
        // Function to close treasure popup
        function closePopup() {
            document.getElementById('treasurePopup').style.visibility = 'hidden';
        }

        // Add keyboard controls for accessibility
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close any open popups
                closePopup();
            }
        });
    </script>
</body>
</html>
